{% extends 'lists/lists-base.html' %}
{% block title %}Show Recipe Information{% endblock %}

{% block content %}

{% if recipe %}

<div class="card">
<div id="recipe-header" class="full-width w-100 overflow-hidden position-relative card-image-top"><img src="{{ recipe.image_url}}" alt="image for {{ recipe.title }}" class="vw-100" id="recipe-image">
    <div id="recipe-heading" class="position-absolute bottom-0">
        <div class="display-2 text-uppercase">{{ recipe.title }}</div>
        {% if g.user %}
        <form method="POST" class="recipe-form">
            <button class="btn btn-lg btn-link bi bi-heart-fill
                  {{'fav' if recipe in g.user.favorites else 'not-fav'}}" data-id="{{ recipe.id }}">
                <!-- {% if recipe.favorites %} -->
                    <!-- <span class="fav-count">{{ recipe.favs() }}</span> -->
                <!-- {% endif %} -->
            </button>
            <div class="btn-group" class="lists-btn">
                <button type="button" class="btn btn-dark btn-sm fw-light dropdown-toggle save-btn" data-bs-toggle="dropdown" aria-expanded="false">SAVE
                </button>

                <ul class="dropdown-menu">
                {% for list in g.user.lists %}
                {% if not list.has_recipe(recipe.id) %}
                    <li data-list="{{ list.id }}" data-recipe="{{ recipe.id }}" class="dropdown-item">
                        {{ list.name }}
                    </li>
                {% endif %}
                {% endfor %}
                </ul>
            </div>
        </form>
        {% endif %}
    </div>
</div>
</div>

<div class="card-body">
<div class="mb-2">
    {% if recipe.source_url %}
        <a class="lead fs-6 pe-2" href="{{ recipe.source_url }}"><em>{{ recipe.source }}</em></a>
    {% endif %}
    {% if recipe.score %}
        <span class="badge rounded-pill bg-success">{{ recipe.score }}%</span>
    {% endif %}
    {% if recipe.tags %}
        {% for tag in recipe.tags %}
            <span class="badge bg-light text-dark text-uppercase">{{ tag }} </span>
        {% endfor %}
    {% endif %}
</div>
{% if recipe.summary %}
    <div class="lead fs-6 lh-lg">{{ recipe.summary }}</div>
{% endif %}
</div>

<div class="card-group row mt-3">
    <div class="card-deck col-6 ps-5">
        <div class="card">
            {% if recipe.ingredients %}
            <h5 class="card-header bg-dark text-light lead m-3">INGREDIENTS</h5>
            <div class="card-body" id="ingredients">
                <div id="us" class="ingredient">
                {% for i in recipe.us %}
                <p>{{ i }}</p>
                {% endfor %}
                <button class="btn btn-sm btn-outline-dark fw-light convert">GET METRIC CONVERSIONS
                </button>
                </div>
                <div id="metric" class="d-none ingredient">
                    {% for i in recipe.metric %}
                    <p>{{ i }}</p>
                    {% endfor %}
                    <button class="btn btn-sm btn-outline-dark fw-light convert">GET US CONVERSIONS
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="card-deck col-6 pe-5">
        <div class="card">
            {% if recipe.instructions %}
            <h5 class="lead card-header bg-dark text-light m-3 text-center">INSTRUCTIONS</h5>
            <div class="card-body">
                <ol>
                    {% for i in recipe.instructions.split(".") %}
                    {% if i| length > 1 %}
                        <li class="pb-4">{{ i }}</li>
                    {% endif %}
                    {% endfor %}
                </ol>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}
{% if similar %}
<div class="vstack gap-3 mt-5">
    <div class="border-bottom p-3 full-width lead">
        YOU MIGHT LIKE THESE TOO...
    </div>
    <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-4 justify-content-evenly">
    {% for s in similar %}
        <div class="card" style="width: 16rem;">
            <div class="card-body px-0 py-auto overflow-scroll align-items-center" style="height: 6rem;">
                <div class="card-title lead fw-bolder"><a class="text-dark text-uppercase stretched-link small" href="{{ url_for('recipe_info', id=s.id)}}">{{ s.title }}</a>
                </div>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item row row-cols-2">
                    <span class="lead fs-6">READY IN:</span>
                    <small class="text-right">{{ s.readyInMinutes}} mins</small>
                </li>
                <li class="list-group-item row row-cols-2"><span class="lead fs-6">SERVINGS:</span><small class="text-right">{{ s.servings }}</small>
                </li>
            </ul>
        </div>
    {% endfor %}
    </div>
</div>
{% endif %}
{% if lists %}
<div class="vstack gap-3 mt-5 mb-5">
    <div class="border-bottom p-3 full-width lead text-uppercase">
        LISTS WITH {{ recipe.title }}
    </div>
    {% block show_lists %}
        {{ super() }}
    {% endblock %}
</div>
{% endif %}
    
{% endblock %}